<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpellForce: Choose Your Origin</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Roboto&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <canvas id="runeCanvas"></canvas>
    <header>
        <h1>SpellForce: Choose Your Origin</h1>
    </header>
    <main class="main-container">
        <div class="origin-grid" id="origin-grid">
            <div id="error-message" style="display: none; text-align: center; font-size: 1rem; color: #FF4D4D;">
                Ошибка загрузки данных. Проверьте origins.json.
            </div>
        </div>
        <div class="selected-view" id="selected-view">
            <div class="selected-card" id="selected-card"></div>
            <div class="description">
                <div>
                    <h2 id="description-title">Выберите Origin</h2>
                    <p id="description-text">Выберите Origin, чтобы узнать его историю и способности.</p>
                </div>
                <div class="scroll-container" id="scroll-container"></div>
            </div>
        </div>
    </main>
    <button class="reset-button" id="reset-button">Вернуться</button>

    <script>
        // Canvas Animation
        const canvas = document.getElementById('runeCanvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const particles = [];
        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 3 + 1;
                this.speedX = Math.random() * 0.6 - 0.3;
                this.speedY = Math.random() * 0.6 - 0.3;
                this.opacity = Math.random() * 0.3 + 0.2;
            }

            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
                if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
            }

            draw() {
                ctx.fillStyle = `rgba(0, 163, 224, ${this.opacity})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        for (let i = 0; i < 30; i++) {
            particles.push(new Particle());
        }

        function animateParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => {
                p.update();
                p.draw();
            });
            requestAnimationFrame(animateParticles);
        }
        animateParticles();

        // Card Selection Logic
        const originGrid = document.getElementById('origin-grid');
        const selectedView = document.getElementById('selected-view');
        const selectedCard = document.getElementById('selected-card');
        const descriptionTitle = document.getElementById('description-title');
        const descriptionText = document.getElementById('description-text');
        const scrollContainer = document.getElementById('scroll-container');
        const resetButton = document.getElementById('reset-button');
        const errorMessage = document.getElementById('error-message');

        let origins = [];

        // Load Origins from JSON
        fetch('origins.json')
            .then(response => {
                if (!response.ok) throw new Error('Failed to load origins.json');
                return response.json();
            })
            .then(data => {
                origins = data;
                renderGrid();
            })
            .catch(error => {
                console.error('Error loading origins:', error);
                errorMessage.style.display = 'block';
            });

        function renderGrid() {
            originGrid.innerHTML = '';
            if (origins.length === 0) {
                errorMessage.style.display = 'block';
                return;
            }

            const totalCards = origins.length;
            const cardsPerRow = Math.ceil(totalCards / 3);
            const rows = [[], [], []];

            // Distribute cards across rows
            origins.forEach((origin, index) => {
                const rowIndex = Math.min(Math.floor(index / cardsPerRow), 2);
                rows[rowIndex].push(origin);
            });

            // Render rows
            rows.forEach(row => {
                if (row.length > 0) {
                    const rowDiv = document.createElement('div');
                    rowDiv.className = 'origin-row';
                    row.forEach(origin => {
                        const card = document.createElement('div');
                        card.className = 'origin-card';
                        card.dataset.origin = origin.id;
                        card.style.width = `calc(100% / ${Math.max(row.length, 3)} - 6px)`; // Min 3 cards per row
                        card.innerHTML = `
                            <img src="${origin.src}" alt="${origin.name}">
                            <div class="overlay">${origin.name}</div>
                        `;
                        rowDiv.appendChild(card);
                    });
                    originGrid.appendChild(rowDiv);
                }
            });

            // Add event listeners
            const originCards = originGrid.querySelectorAll('.origin-card');
            originCards.forEach(card => {
                card.addEventListener('click', () => {
                    selectOrigin(card.dataset.origin);
                });
            });
        }

        function selectOrigin(id) {
            originGrid.style.display = 'none';
            selectedView.style.display = 'flex';
            resetButton.style.display = 'block';

            const origin = origins.find(o => o.id === id);
            selectedCard.innerHTML = `
                <img src="${origin.src}" alt="${origin.name}">
            `;
            descriptionTitle.textContent = origin.name;
            descriptionText.textContent = origin.description || `Описание для ${origin.name}`;

            scrollContainer.innerHTML = '';
            origins.forEach(o => {
                if (o.id !== id) {
                    scrollContainer.innerHTML += `
                        <div class="scroll-card" data-origin="${o.id}">
                            <img src="${o.src}" alt="${o.name}">
                            <div class="overlay">${o.name}</div>
                        </div>
                    `;
                }
            });

            const scrollCards = scrollContainer.querySelectorAll('.scroll-card');
            scrollCards.forEach(card => {
                card.addEventListener('click', () => {
                    selectOrigin(card.dataset.origin);
                });
            });
        }

        resetButton.addEventListener('click', () => {
            originGrid.style.display = 'flex';
            selectedView.style.display = 'none';
            resetButton.style.display = 'none';
        });

        // Resize Canvas
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>