<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lost Edge of Time - Character</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            background-color: #0A0A0A;
            color: #D9E4DD;
        }
        
        #particle-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        
        header {
            background: rgba(26, 38, 57, 0.8);
            padding: 1rem;
            text-align: center;
            border-bottom: 2px solid #00A3E0;
        }
        
        h1 {
            margin: 0;
            font-family: 'Cinzel', serif;
        }
        
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        .tab-container {
            display: flex;
            justify-content: center;
            margin-bottom: 1rem;
        }
        
        .tab {
            padding: 0.5rem 1rem;
            background: #1A2639;
            color: #D9E4DD;
            border: 1px solid #00A3E0;
            cursor: pointer;
            font-family: 'Cinzel', serif;
        }
        
        .tab.active {
            background: #00A3E0;
            color: #0A0A0A;
            font-weight: bold;
        }
        
        .character-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 1rem;
            height: calc(100vh - 150px);
            overflow-y: auto;
        }
        
        .character-portrait {
            width: 100%;
            height: 250px;
            background: #1A2639;
            border: 2px solid #00A3E0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .character-portrait img {
            max-width: 100%;
            max-height: 100%;
        }
        
        .character-info {
            margin-top: 1rem;
        }
        
        .character-info input,
        .character-info textarea {
            width: 100%;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: rgba(26, 38, 57, 0.8);
            border: 1px solid #00A3E0;
            color: #D9E4DD;
        }
        
        .character-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        button {
            padding: 0.5rem;
            background: #00A3E0;
            color: #0A0A0A;
            border: none;
            cursor: pointer;
            font-family: 'Cinzel', serif;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: rgba(26, 38, 57, 0.8);
            border: 1px solid #00A3E0;
        }
        
        .stat-controls {
            display: flex;
            align-items: center;
        }
        
        .stat-value {
            margin: 0 0.5rem;
            min-width: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <header>
        <h1>Lost Edge of Time - Character</h1>
    </header>
    
    <div class="main-container">
        <div class="tab-container">
            <a href="index.html" class="tab">Origin</a>
            <a href="race.html" class="tab">Race</a>
            <a href="traits.html" class="tab">Traits</a>
            <a href="powersets.html" class="tab">Power Sets</a>
            <a href="character.html" class="tab active">Character</a>
        </div>
        
        <div class="character-container">
            <div>
                <div class="character-portrait" id="character-portrait">
                    <span>Click to upload portrait</span>
                    <input type="file" id="portrait-upload" accept="image/*" style="display: none;">
                </div>
                
                <div class="character-info">
                    <input type="text" id="character-name" placeholder="Character Name">
                    <textarea id="character-bio" placeholder="Character Biography" rows="4"></textarea>
                    
                    <div>
                        <input type="text" id="character-uid" placeholder="Character UID" readonly>
                        <button id="generate-uid-btn">Generate UID</button>
                    </div>
                    
                    <div>
                        <input type="text" id="load-uid-input" placeholder="Enter UID to load">
                        <button id="load-character-btn">Load</button>
                    </div>
                    
                    <div class="character-actions">
                        <button id="save-character-btn">Save Character</button>
                        <button id="clear-character-btn">Clear</button>
                    </div>
                </div>
            </div>
            
            <div>
                <div class="stat-item">
                    <span>Сила (STR):</span>
                    <div class="stat-controls">
                        <button class="stat-btn" data-stat="str" data-action="decrease">-</button>
                        <span class="stat-value" id="str-value">0</span>
                        <button class="stat-btn" data-stat="str" data-action="increase">+</button>
                    </div>
                </div>
                
                <div class="stat-item">
                    <span>Выносливость (CON):</span>
                    <div class="stat-controls">
                        <button class="stat-btn" data-stat="con" data-action="decrease">-</button>
                        <span class="stat-value" id="con-value">0</span>
                        <button class="stat-btn" data-stat="con" data-action="increase">+</button>
                    </div>
                </div>
                
                <div class="stat-item">
                    <span>Сноровка (DEX):</span>
                    <div class="stat-controls">
                        <button class="stat-btn" data-stat="dex" data-action="decrease">-</button>
                        <span class="stat-value" id="dex-value">0</span>
                        <button class="stat-btn" data-stat="dex" data-action="increase">+</button>
                    </div>
                </div>
                
                <div class="stat-item">
                    <span>Ловкость (AGI):</span>
                    <div class="stat-controls">
                        <button class="stat-btn" data-stat="agi" data-action="decrease">-</button>
                        <span class="stat-value" id="agi-value">0</span>
                        <button class="stat-btn" data-stat="agi" data-action="increase">+</button>
                    </div>
                </div>
                
                <div class="stat-item">
                    <span>Интеллект (INT):</span>
                    <div class="stat-controls">
                        <button class="stat-btn" data-stat="int" data-action="decrease">-</button>
                        <span class="stat-value" id="int-value">0</span>
                        <button class="stat-btn" data-stat="int" data-action="increase">+</button>
                    </div>
                </div>
                
                <div class="stat-item">
                    <span>Мудрость (WIS):</span>
                    <div class="stat-controls">
                        <button class="stat-btn" data-stat="wis" data-action="decrease">-</button>
                        <span class="stat-value" id="wis-value">0</span>
                        <button class="stat-btn" data-stat="wis" data-action="increase">+</button>
                    </div>
                </div>
                
                <div class="stat-item">
                    <span>Обаяние (CHA):</span>
                    <div class="stat-controls">
                        <button class="stat-btn" data-stat="cha" data-action="decrease">-</button>
                        <span class="stat-value" id="cha-value">0</span>
                        <button class="stat-btn" data-stat="cha" data-action="increase">+</button>
                    </div>
                </div>
                
                <div style="margin-top: 1rem; padding: 0.5rem; background: rgba(26, 38, 57, 0.8); text-align: center;">
                    Points left: <span id="points-left">36</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Инициализация Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyATqz2FEvuqJuFpeRNWs7MZ_G-jeEPk_dA",
            authDomain: "leot-rpg.firebaseapp.com",
            databaseURL: "https://leot-rpg-default-rtdb.firebaseio.com",
            projectId: "leot-rpg",
            storageBucket: "leot-rpg.appspot.com",
            messagingSenderId: "778831773412",
            appId: "1:778831773412:web:b27c883c463e41a25d36f1",
            measurementId: "G-P40D2VF1TQ"
        };
        
        // Инициализируем Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Состояние приложения
        const state = {
            pointsLeft: 36,
            stats: {
                str: 0,
                con: 0,
                dex: 0,
                agi: 0,
                int: 0,
                wis: 0,
                cha: 0
            },
            portrait: null
        };
        
        // DOM элементы
        const elements = {
            portraitUpload: document.getElementById('portrait-upload'),
            portraitContainer: document.getElementById('character-portrait'),
            characterName: document.getElementById('character-name'),
            characterBio: document.getElementById('character-bio'),
            characterUid: document.getElementById('character-uid'),
            loadUidInput: document.getElementById('load-uid-input'),
            pointsLeft: document.getElementById('points-left'),
            statValues: {
                str: document.getElementById('str-value'),
                con: document.getElementById('con-value'),
                dex: document.getElementById('dex-value'),
                agi: document.getElementById('agi-value'),
                int: document.getElementById('int-value'),
                wis: document.getElementById('wis-value'),
                cha: document.getElementById('cha-value')
            }
        };
        
        // Инициализация приложения
        function init() {
            // Обработчики для кнопок характеристик
            document.querySelectorAll('.stat-btn').forEach(btn => {
                btn.addEventListener('click', handleStatChange);
            });
            
            // Обработчики для основных кнопок
            document.getElementById('generate-uid-btn').addEventListener('click', generateUid);
            document.getElementById('save-character-btn').addEventListener('click', saveCharacter);
            document.getElementById('load-character-btn').addEventListener('click', loadCharacter);
            document.getElementById('clear-character-btn').addEventListener('click', clearCharacter);
            
            // Обработчик загрузки портрета
            elements.portraitContainer.addEventListener('click', () => elements.portraitUpload.click());
            elements.portraitUpload.addEventListener('change', handlePortraitUpload);
            
            // Обновляем отображение
            updateUI();
        }
        
        // Обработчик изменения характеристик
        function handleStatChange(e) {
            const stat = e.target.getAttribute('data-stat');
            const action = e.target.getAttribute('data-action');
            
            if (action === 'increase' && state.pointsLeft > 0 && state.stats[stat] < 10) {
                state.stats[stat]++;
                state.pointsLeft--;
                updateUI();
            } else if (action === 'decrease' && state.stats[stat] > 0) {
                state.stats[stat]--;
                state.pointsLeft++;
                updateUI();
            }
        }
        
        // Обработчик загрузки портрета
        function handlePortraitUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    elements.portraitContainer.innerHTML = `<img src="${event.target.result}" alt="Character Portrait">`;
                    state.portrait = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Генерация UID
        function generateUid() {
            const uid = 'xxxx-xxxx'.replace(/[x]/g, () => 
                Math.floor(Math.random() * 16).toString(16)
            );
            elements.characterUid.value = uid;
            elements.loadUidInput.value = uid;
        }
        
        // Сохранение персонажа
        function saveCharacter() {
            const uid = elements.characterUid.value;
            if (!uid) {
                alert('Пожалуйста, сгенерируйте UID сначала');
                return;
            }
            
            const characterData = {
                name: elements.characterName.value,
                bio: elements.characterBio.value,
                stats: state.stats,
                portrait: state.portrait,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };
            
            database.ref('characters/' + uid).set(characterData)
                .then(() => alert('Персонаж сохранен с UID: ' + uid))
                .catch(error => alert('Ошибка сохранения: ' + error.message));
        }
        
        // Загрузка персонажа
        function loadCharacter() {
            const uid = elements.loadUidInput.value.trim();
            if (!uid) {
                alert('Пожалуйста, введите UID для загрузки');
                return;
            }
            
            database.ref('characters/' + uid).once('value')
                .then(snapshot => {
                    const data = snapshot.val();
                    if (data) {
                        // Загружаем данные
                        elements.characterName.value = data.name || '';
                        elements.characterBio.value = data.bio || '';
                        elements.characterUid.value = uid;
                        
                        // Загружаем характеристики
                        state.stats = data.stats || {
                            str: 0, con: 0, dex: 0, agi: 0, 
                            int: 0, wis: 0, cha: 0
                        };
                        
                        // Пересчитываем очки
                        state.pointsLeft = 36 - Object.values(state.stats).reduce((a, b) => a + b, 0);
                        
                        // Загружаем портрет
                        if (data.portrait) {
                            elements.portraitContainer.innerHTML = `<img src="${data.portrait}" alt="Character Portrait">`;
                            state.portrait = data.portrait;
                        } else {
                            elements.portraitContainer.innerHTML = '<span>Click to upload portrait</span>';
                            state.portrait = null;
                        }
                        
                        updateUI();
                        alert('Персонаж успешно загружен!');
                    } else {
                        alert('Персонаж с таким UID не найден');
                    }
                })
                .catch(error => alert('Ошибка загрузки: ' + error.message));
        }
        
        // Очистка формы
        function clearCharacter() {
            if (confirm('Вы уверены, что хотите очистить все данные персонажа?')) {
                // Сбрасываем характеристики
                state.stats = {
                    str: 0, con: 0, dex: 0, agi: 0, 
                    int: 0, wis: 0, cha: 0
                };
                state.pointsLeft = 36;
                state.portrait = null;
                
                // Очищаем поля
                elements.characterName.value = '';
                elements.characterBio.value = '';
                elements.characterUid.value = '';
                elements.loadUidInput.value = '';
                elements.portraitContainer.innerHTML = '<span>Click to upload portrait</span>';
                elements.portraitUpload.value = '';
                
                updateUI();
            }
        }
        
        // Обновление интерфейса
        function updateUI() {
            // Обновляем значения характеристик
            for (const stat in state.stats) {
                elements.statValues[stat].textContent = state.stats[stat];
            }
            
            // Обновляем оставшиеся очки
            elements.pointsLeft.textContent = state.pointsLeft;
        }
        
        // Запускаем приложение
        init();
    </script>
</body>
</html>
